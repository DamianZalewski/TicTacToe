<!DOCTYPE HTML>
<html>

<head>
    <title>Tic Tac Toe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            padding: 0;
            margin: 0;
            background-color: darkgray;
            overflow: hidden;
        }

        canvas {
            width: 100vw;
            height: 100vh;
        }

    </style>
</head>


<body>

    <canvas></canvas>

    <script>
        const canvas = document.querySelector('canvas');
        const ctx = canvas.getContext('2d');
        console.log(screen.width);
        canvas.width = screen.width;
        canvas.height = screen.height;
        cw = canvas.width;
        ch = canvas.height;
        console.log("cw :" + cw);
        console.log("ch :" + ch);
        // main menu variables
        var boxColorTop = "white";
        var boxColorBot = "white";
        var boxTextColorTop = "black";
        var boxTextColorBot = "black";
        // -----------------

        let stage = 2;
        //----------
        var IconTab = [0, 0, 0, 0, 0, 0, 0, 0, 0];
        var squareTurn = [null, null, null, null, null, null, null, null, null];
        var turnSide = true; // true - circle , false - x
        //-------------
        var scoreX = 0;
        var scoreY = 0;
        //-------------
        var firstDelay = true;
        //-------------
        var xColor = "green";
        var oColor = "red";
        //responsive
        var mainTitleSize,
            menuBoxX,
            menuBoxY,
            buttonWidth,
            buttonHeight,
            fontSize;

        var gameBoardFirstVerticalX,
            gameBoardFirstVerticalY,
            gameBoardSecondVerticalX,
            gameBoardSecondVerticalY,
            gameBoardFirstHorizontalX,
            gameBoardFirstHorizontalY,
            gameBoardSecondHorizontalX,
            gameBoardSecondHorizontalY,
            gameBoardWidth,
            gameBoardHeight;
        var gameSquareSize;

        //---------------

        var topGameMenuX,
            topGameMenuY,
            topMenuFont;
        //---------------
        var scoreFontSize,
            xPlayerTitleX,
            xPlayerTitleY,
            oPlayerTitleX,
            oPlayerTitleY,
            xScoreX,
            xScoreY,
            oScoreX,
            oScoreY;
        //---------------
        var backIconFont,
            backIconX,
            backIconY;


        // media responsible 
        if (cw <= 320 && ch <= 533) {
            mainTitleSize = 45 + "px Arial";
            buttonWidth = 250;
            buttonHeight = 70;
            menuBoxX = cw / 2 - buttonWidth / 2;
            menuBoxY = 170;
            fontSize = 30;

            //--------------
            gameSquareSize = 80;

            gameBoardWidth = 5;
            gameBoardHeight = 3 * gameSquareSize + 3 * gameBoardWidth;

            gameBoardFirstVerticalX = (cw / 2) - (gameSquareSize / 2) - gameBoardWidth;
            gameBoardFirstVerticalY = 110;

            gameBoardSecondVerticalX = gameBoardFirstVerticalX + gameSquareSize + gameBoardWidth;
            gameBoardSecondVerticalY = gameBoardFirstVerticalY;

            gameBoardFirstHorizontalX = (cw / 2) - (1.5 * gameSquareSize) - gameBoardWidth;
            gameBoardFirstHorizontalY = gameBoardFirstVerticalY + gameSquareSize;

            gameBoardSecondHorizontalX = gameBoardFirstHorizontalX;
            gameBoardSecondHorizontalY = gameBoardFirstHorizontalY + gameSquareSize + gameBoardWidth;

            //----------------
            topMenuFont = 30;
            topGameMenuY = 70;
            topGameMenuX = cw / 2;
            //----------------
            scoreTitlesFontSize = 36;
            xPlayerTitleX = 10;
            xPlayerTitleY = ch - 110;
            oPlayerTitleX = cw - 10;
            oPlayerTitleY = xPlayerTitleY;
            ScoresFont = 56;
            xScoreX = 75;
            xScoreY = xPlayerTitleY + 55;
            oScoreX = cw - xScoreX;
            oScoreY = xScoreY;
            //----------------
            backIconFont = 24;
            backIconX = 10;
            backIconY = 24;

        }

        function drawBackIcon() {
            ctx.fillStyle = 'white';
            ctx.font = backIconFont + "px Arial";
            ctx.textAlign = "left";
            ctx.fillText("< menu", backIconX, backIconY);
        }

        function showScore() {
            ctx.font = scoreTitlesFontSize + "px Arial";
            ctx.fillStyle = xColor;
            ctx.textAlign = "left";
            ctx.fillText("Gracz X", xPlayerTitleX, xPlayerTitleY);
            ctx.textAlign = "right";
            ctx.fillStyle = oColor;
            ctx.fillText("Gracz O", oPlayerTitleX, oPlayerTitleY);
            ctx.textAlign = "center";
            ctx.fillStyle = 'white';
            ctx.font = ScoresFont + "px Arial";
            ctx.fillText(scoreX, xScoreX, xScoreY);
            ctx.fillText(scoreY, oScoreX, oScoreY);
        }


        function topMenu() {
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.font = topMenuFont + "px Arial";
            if (!turnSide)
                ctx.fillText("runda gracza : X", topGameMenuX, topGameMenuY);
            else
                ctx.fillText("runda gracza : O", topGameMenuX, topGameMenuY);
        }


        // create start board fill by a black color;
        function board() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, cw, ch);
        }
        // draw main menu buttons and make their hover state
        function mainMenu() {
            ctx.fillStyle = "white";
            ctx.font = mainTitleSize;
            ctx.textAlign = "center";
            ctx.fillText("Tic Tac Toe", cw / 2, 100);
            ctx.fillStyle = boxColorTop;
            ctx.fillRect(menuBoxX, menuBoxY, buttonWidth, buttonHeight);
            ctx.fillStyle = boxColorBot;
            ctx.fillRect(menuBoxX, menuBoxY + buttonHeight * 2, buttonWidth, buttonHeight);
            ctx.fillStyle = boxTextColorTop;
            ctx.font = fontSize + "px Arial";
            ctx.fillText("Player vs Player", cw / 2, menuBoxY + buttonHeight - fontSize * 0.8);
            ctx.fillStyle = boxTextColorBot;
            ctx.fillText("Player vs Comp", cw / 2, menuBoxY + buttonHeight * 3 - fontSize * 0.8);
        }

        function mainMenuOption(e) {
            // -----------------------
            console.log('-------------test------------');

            console.log("menuBoxX :" + menuBoxX);
            console.log("menuBoxX :" + menuBoxX);
            console.log("e.clientX :" + e.clientX);
            //-----------------------
            var flagA = false;
            var flagB = false;
            if (e.clientX >= menuBoxX &&
                e.clientX <= menuBoxX + buttonWidth &&
                e.clientY >= menuBoxY &&
                e.clientY <= menuBoxY + buttonHeight
            ) {
                boxColorTop = "red";
                boxTextColorTop = "white";
                flagA = true;
            } else {
                boxColorTop = "white";
                boxTextColorTop = "black";
                flagA = false;
            }
            if (e.clientX >= menuBoxX &&
                e.clientX <= menuBoxX + buttonWidth &&
                e.clientY >= menuBoxY + buttonHeight * 2 &&
                e.clientY <= menuBoxY + buttonHeight * 3
            ) {
                boxColorBot = "red";
                boxTextColorBot = "white";
                flagB = true;
            } else {
                boxColorBot = "white";
                boxTextColorBot = "black";
                flagB = false;
            }
            if ((flagA || flagB) && stage == 1) {
                canvas.style.cursor = "pointer";
            } else {
                canvas.style.cursor = "context-menu";
            }
        }

        function changeStage(e) {
            if (e.clientX >= menuBoxX &&
                e.clientX <= menuBoxX + buttonWidth &&
                e.clientY >= menuBoxY &&
                e.clientY <= menuBoxY + buttonHeight
            ) {
                stage = 2;
            }

            if (e.clientX >= menuBoxX &&
                e.clientX <= menuBoxX + buttonWidth &&
                e.clientY >= menuBoxY + buttonHeight * 2 &&
                e.clientY <= menuBoxY + buttonHeight * 3
            ) {
                stage = 3;
            }
        }

        function gameBoard() {
            ctx.fillStyle = "white";
            //vertical
            ctx.fillRect(gameBoardFirstVerticalX, gameBoardFirstVerticalY, gameBoardWidth, gameBoardHeight);
            ctx.fillRect(gameBoardSecondVerticalX, gameBoardSecondVerticalY, gameBoardWidth, gameBoardHeight);


            //horizontal
            ctx.fillRect(gameBoardFirstHorizontalX, gameBoardFirstHorizontalY, gameBoardHeight, gameBoardWidth);
            ctx.fillRect(gameBoardSecondHorizontalX, gameBoardSecondHorizontalY, gameBoardHeight, gameBoardWidth);
        }

        function chooseSquare(e) {
            // first 3 square
            if (e.clientX >= leftCanvas + cw / 2 - 165 &&
                e.clientX <= leftCanvas + cw / 2 - 60 &&
                e.clientY >= topCanvas + 60 &&
                e.clientY <= topCanvas + ch / 2 - 60
            ) {
                if (IconTab[0] == 0) {
                    //   console.log("pole 1");
                    IconTab[0] = 1;
                    turnSide = !turnSide;
                }
            } else
            if (e.clientX >= leftCanvas + cw / 2 - 60 &&
                e.clientX <= leftCanvas + cw / 2 + 60 &&
                e.clientY >= topCanvas + 60 &&
                e.clientY <= topCanvas + ch / 2 - 60
            ) {
                if (IconTab[1] == 0) {
                    //   console.log("pole 2");
                    IconTab[1] = 1;
                    turnSide = !turnSide;
                }
            } else
            if (e.clientX >= leftCanvas + cw / 2 + 65 &&
                e.clientX <= leftCanvas + cw / 2 + 185 &&
                e.clientY >= topCanvas + 60 &&
                e.clientY <= topCanvas + ch / 2 - 60
            ) {
                if (IconTab[2] == 0) {
                    //   console.log("pole 3");
                    IconTab[2] = 1;
                    turnSide = !turnSide;
                }
            }
            // second 3 square
            else if (e.clientX >= leftCanvas + cw / 2 - 165 &&
                e.clientX <= leftCanvas + cw / 2 - 60 &&
                e.clientY >= topCanvas + ch / 2 - 60 &&
                e.clientY <= topCanvas + ch / 2 + 60
            ) {
                if (IconTab[3] == 0) {
                    //  console.log("pole 4");
                    IconTab[3] = 1;
                    turnSide = !turnSide;
                }
            } else
            if (e.clientX >= leftCanvas + cw / 2 - 60 &&
                e.clientX <= leftCanvas + cw / 2 + 60 &&
                e.clientY >= topCanvas + ch / 2 - 60 &&
                e.clientY <= topCanvas + ch / 2 + 60
            ) {
                if (IconTab[4] == 0) {
                    //   console.log("pole 5");
                    IconTab[4] = 1;
                    turnSide = !turnSide;
                }
            } else
            if (e.clientX >= leftCanvas + cw / 2 + 65 &&
                e.clientX <= leftCanvas + cw / 2 + 185 &&
                e.clientY >= topCanvas + ch / 2 - 60 &&
                e.clientY <= topCanvas + ch / 2 + 60
            ) {
                if (IconTab[5] == 0) {
                    //  console.log("pole 6");
                    IconTab[5] = 1;
                    turnSide = !turnSide;
                }
            }
            // third 3 square
            else if (e.clientX >= leftCanvas + cw / 2 - 165 &&
                e.clientX <= leftCanvas + cw / 2 - 60 &&
                e.clientY >= topCanvas + ch / 2 + 60 &&
                e.clientY <= topCanvas + ch / 2 + 200
            ) {
                if (IconTab[6] == 0) {
                    //   console.log("pole 7");
                    IconTab[6] = 1;
                    turnSide = !turnSide;
                }
            } else
            if (e.clientX >= leftCanvas + cw / 2 - 60 &&
                e.clientX <= leftCanvas + cw / 2 + 60 &&
                e.clientY >= topCanvas + ch / 2 + 60 &&
                e.clientY <= topCanvas + ch / 2 + 200
            ) {
                if (IconTab[7] == 0) {
                    // console.log("pole 8");
                    IconTab[7] = 1;
                    turnSide = !turnSide;
                }
            } else
            if (e.clientX >= leftCanvas + cw / 2 + 65 &&
                e.clientX <= leftCanvas + cw / 2 + 185 &&
                e.clientY >= topCanvas + ch / 2 + 60 &&
                e.clientY <= topCanvas + ch / 2 + 200
            ) {
                if (IconTab[8] == 0) {
                    // console.log("pole 9");
                    IconTab[8] = 1;
                    turnSide = !turnSide;
                }
            }
            // back to main menu button
            if (e.clientX >= leftCanvas + 30 &&
                e.clientX <= leftCanvas + 180 &&
                e.clientY >= topCanvas + ch - 70 &&
                e.clientY <= topCanvas + ch
            ) goBack();
            //console.log(squareTurn);
        }

        function drawIcon() {
            ctx.fillStyle = "white";
            ctx.font = "80px Arial";
            ctx.textAlign = "center";
            //first 3 square
            if (IconTab[0] == 1) {
                if (squareTurn[0] == null) {
                    squareTurn[0] = turnSide;
                }
                if (squareTurn[0]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2 - 120, 150)
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2 - 120, 150)
                }
            }
            if (IconTab[1] == 1) {
                if (squareTurn[1] == null) {
                    squareTurn[1] = turnSide;
                }
                if (squareTurn[1]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2, 150);
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2, 150);
                }
            }
            if (IconTab[2] == 1) {
                if (squareTurn[2] == null) {
                    squareTurn[2] = turnSide;
                }
                if (squareTurn[2]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2 + 120, 150);
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2 + 120, 150);
                }
            }
            //second 3 square
            if (IconTab[3] == 1) {
                if (squareTurn[3] == null) {
                    squareTurn[3] = turnSide;
                }
                if (squareTurn[3]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2 - 120, 280);
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2 - 120, 280);
                }
            }
            if (IconTab[4] == 1) {
                if (squareTurn[4] == null) {
                    squareTurn[4] = turnSide;
                }
                if (squareTurn[4]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2, 280);
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2, 280);
                }
            }
            if (IconTab[5] == 1) {
                if (squareTurn[5] == null) {
                    squareTurn[5] = turnSide;
                }
                if (squareTurn[5]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2 + 120, 280);
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2 + 120, 280);
                }
            }
            //third 3 square
            if (IconTab[6] == 1) {
                if (squareTurn[6] == null) {
                    squareTurn[6] = turnSide;
                }
                if (squareTurn[6]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2 - 120, 400);
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2 - 120, 400);
                }
            }
            if (IconTab[7] == 1) {
                if (squareTurn[7] == null) {
                    squareTurn[7] = turnSide;
                }
                if (squareTurn[7]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2, 400);
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2, 400);
                }
            }
            if (IconTab[8] == 1) {
                if (squareTurn[8] == null) {
                    squareTurn[8] = turnSide;
                }
                if (squareTurn[8]) {
                    ctx.fillStyle = xColor;
                    ctx.fillText("X", cw / 2 + 120, 400);
                } else {
                    ctx.fillStyle = oColor;
                    ctx.fillText("O", cw / 2 + 120, 400);
                }
            }
        }





        function winner(con) {
            con ? scoreX++ : scoreY++;
            IconTab = [0, 0, 0, 0, 0, 0, 0, 0, 0];
            squareTurn = [null, null, null, null, null, null, null, null, null];
        }

        function checkWin() {
            var con = true;
            if (squareTurn[0] == con && squareTurn[1] == con && squareTurn[2] == con) winner(con);
            else
            if (squareTurn[3] == con && squareTurn[4] == con && squareTurn[5] == con) winner(con);
            else
            if (squareTurn[6] == con && squareTurn[7] == con && squareTurn[8] == con) winner(con);
            else
            if (squareTurn[0] == con && squareTurn[3] == con && squareTurn[6] == con) winner(con);
            else
            if (squareTurn[1] == con && squareTurn[4] == con && squareTurn[7] == con) winner(con);
            else
            if (squareTurn[2] == con && squareTurn[5] == con && squareTurn[8] == con) winner(con);
            else
            if (squareTurn[0] == con && squareTurn[4] == con && squareTurn[8] == con) winner(con);
            else
            if (squareTurn[2] == con && squareTurn[4] == con && squareTurn[6] == con) winner(con);
            con = false;
            if (squareTurn[0] == con && squareTurn[1] == con && squareTurn[2] == con) winner(con);
            else
            if (squareTurn[3] == con && squareTurn[4] == con && squareTurn[5] == con) winner(con);
            else
            if (squareTurn[6] == con && squareTurn[7] == con && squareTurn[8] == con) winner(con);
            else
            if (squareTurn[0] == con && squareTurn[3] == con && squareTurn[6] == con) winner(con);
            else
            if (squareTurn[1] == con && squareTurn[4] == con && squareTurn[7] == con) winner(con);
            else
            if (squareTurn[2] == con && squareTurn[5] == con && squareTurn[8] == con) winner(con);
            else
            if (squareTurn[0] == con && squareTurn[4] == con && squareTurn[8] == con) winner(con);
            else
            if (squareTurn[2] == con && squareTurn[4] == con && squareTurn[6] == con) winner(con);
            else {
                var check = true;
                for (var i = 0; i <= 8; i++) {
                    squareTurn[i] == null ? check = false : null;
                    // console.log(check);
                }
                if (check) {
                    IconTab = [0, 0, 0, 0, 0, 0, 0, 0, 0];
                    squareTurn = [null, null, null, null, null, null, null, null, null];
                }
            }
        }



        function goBack() {
            stage = 1;
            IconTab = [0, 0, 0, 0, 0, 0, 0, 0, 0];
            squareTurn = [null, null, null, null, null, null, null, null, null];
            scoreX = 0;
            scoreY = 0;
            turnSide = true;
            firstDelay = true;
            canvas.removeEventListener("mousedown", chooseSquare);
            clearTimeout(setEvents);
        }

        function computerAI() {
            var checkSlot = false;
            for (var i = 0; i <= 8; i++) {
                if (IconTab[i] == 0) {
                    checkSlot = true;
                }
            }
            while (checkSlot) {
                var random = Math.floor(Math.random() * 8) + 0;
                // console.log(random);
                if (IconTab[random] == 0) {
                    IconTab[random] = 1;
                    turnSide = !turnSide;
                    break;
                }
            }
        }

        function setEvents() {
            canvas.removeEventListener("mousedown", changeStage);
            canvas.addEventListener("click", chooseSquare);
        }

        function game() {
            // console.log(stage);
            //console.log(firstDelay);
            if (stage == 1) {
                board();
                // main menu
                mainMenu();
                canvas.addEventListener("mousemove", mainMenuOption);
                canvas.addEventListener("mousedown", changeStage);
                firstDelay = true;
            } else if (stage == 2) {
                //console.log("------------STAGE 2-------------");
                if (firstDelay == true) {
                    console.log("kek");
                    setTimeout(setEvents, 150);
                    firstDelay = false;
                }
                board();
                //player vs player
                drawBackIcon();
                gameBoard();
                //drawIcon();
                topMenu();
                showScore();
                // checkWin();
            } else // stage == 3
            {
                console.log("------------STAGE 3-------------");
                canvas.removeEventListener("mousedown", changeStage);
                board();
                //player vs computer
                drawBackIcon();
                gameBoard();
                drawIcon();
                topMenu();
                showScore();
                checkWin();
                if (turnSide == true) {
                    canvas.addEventListener("click", chooseSquare);
                }
                if (turnSide == false) {
                    canvas.removeEventListener("click", chooseSquare);
                    turnSide = null;
                    setTimeout(computerAI, 800);
                }
                //  console.log(turnSide)
            }
        }
        //init
        setInterval(game, 1000 / 60);

    </script>
</body>

</html>
